# RESTful API (DARS TEST)

## Методы передачи данных

| Действие      | Метод |
| --------- | -----|
| index  | GET |
| view     |  GET |
| create      |   POST |
| update      |   POST |
| delete      |   DELETE, POST |

BASE URL для отправки запросов через API: **http://localhost:8001/**

## Общая информация
+ URL запросы через API полностью повторяют CRUD (подробности в файле README.md).
+ Ответы сервера включают в себя **статус ответа (status)**, **код ответа (code)**, **тело сообщения (data)**, а также **доступные страницы (_links)** и **общую информацию по данным таблицы (_meta)**, например:
```
{
    "status": "ok",
    "code": 200,
    "data": {
        ...
    },
    "_links": {
        "self": {
            "href": "http://localhost:8001/authors?page=1"
        },
        "first": {
            "href": "http://localhost:8001/authors?page=1"
        },
        "last": {
            "href": "http://localhost:8001/authors?page=1"
        }
    },
    "_meta": {
        "totalCount": 10,
        "pageCount": 1,
        "currentPage": 1,
        "perPage": 20
    }
}
```

## Просмотр всех данных таблицы
Для просмотра всех данных в таблице необходимо отправить **GET** запрос по адресу:
> http://localhost:8001/table_name

>Например: http://localhost:8001/author

В ответ на запрос вы получите список всех данных из запрашиваемой таблицы:
```
{
    ...
    "data": {
        "response": [
            {
                "id": 1,
                "name": "Автор 1",
                "country": "РОССИЯ"
            },
            {
                "id": 2,
                "name": "Автор 2",
                "country": "США"
            }
        ],
        ...
    }
}
```
Для вывода постраничной информации передайте параметр **page** в URL запроса:
> http://localhost:8001/table_name?page=NUM

>Например: http://localhost:8001/author?page=2



## Создание записи
Для создания записи необходимо отправить **POST** запрос с данными по адресу:
> http://localhost:8001/table_name/create

>Например: http://localhost:8001/author/create

Список обязательных для передачи переменных:

| Таблица | Обязательные переменные |  Информация                                 |
| ---------  | --------------------------------| ---------------------------------------|
| author    | name                                      |                                                          |
|                | country_id                              | GET http://localhost:8001/country |
| genre     |  title                                        |                                                          |
| book      |  title                                        |                                                          |
|               |   author_id                              | GET http://localhost:8001/author    |
|               |   genre[] (IDs из genre)          | GET http://localhost:8001/genre     |
|               |   publish_date                         | в формате ДД.ММ.ГГГГ                  |

В ответ на запрос вы получите данные созданной записи:
```
{
    ...
    "data": {
        "id": 1,
        "name": "Автор 1",
        "country": "РОССИЯ"
    }
}
```

## Редактирование записи
Для редактирования записи необходимо отправить **POST** запрос с данными, указывая **ID** редактируемой записи, по адресу:
> http://localhost:8001/table_name/update?id=ID

>Например: http://localhost:8001/author/update?id=1

В ответ на запрос вы получите обновленные данные записи:
```
{
    ...
    "data": {
        "id": 1,
        "name": "Автор 2",
        "country": "США"
    }
}
```

## Удаление записи
Для удаления записи необходимо отправить **POST** или **DELETE** запрос с данными, указывая **ID** удаляемой записи, по адресу:
> http://localhost:8001/table_name/delete?id=ID

>Например: http://localhost:8001/author/delete?id=1

В ответ на запрос вы получите **BOOLEAN** с результатом действия.

## Поиск и фильтрация информации
Поиск и фильтры доступны по всем таблицам, несмотря на то, что в задании фигурирет только таблица **book**. Формат запросов и ответов для всех таблиц одинаков.
Для поиска и фильтрации информации необходимо отправить **GET** запрос с поискомыми параметрами по адресу:
> http://localhost:8001/table_name?search_params

>Например: http://localhost:8001/book?title=книга&author_name=автор

В ответ на запрос вы получите данные по поисковому запросу:
```
{
    ...
    "data": {
        "response": [
            {
                "id": 3,
                "title": "Книга 2",
                "author": "Автор 3",
                "country": "АВСТРИЯ",
                "genres": {
                    "3": "Роман",
                    "4": "Детектив"
                },
                "publish_date": " 20.04.2006"
            },
        ],
        ...
        }
    }
}
```
Список доступных для поиска и фильтрации данных

| Таблица | Данные             |  Описание                                                     |
| ---------  | ----------------- | -------------------------------------------------|
| author    | id                       | **int**                                                            |
|                | name                 | **string** Имя автора                                  |
|                | country_name   | **string** Наименование страны               |
| genre     |  id                       | **int**                                                            |
|               |  title                    | **string** Наименование жанра                 |
| country  |  id                      |  **int**                                                            |
|               |   code                 | **int** Цифровой код                                   |
|               |   name                | **string** Краткое наименование страны  |
|               |   fullname           | **string** Полное наименование страны   |
|               |   alpha2               | **string** 2-х символьный код                   |
|               |   alpha3               | **string** 3-х символьный код                   |
| book      |  id                        | **int**                                                           |
|               |   title                    | **string** Наименование книги                 |
|               |  author_name      | **string** Имя автора                                 |
|               |   country_name   | **string** Имя автора                                 |
|               |   publish_date     | **date** Дата публикации                           |
|               |   | Поиск возможен по целой дате или рандомным числам      |

Для поиска данных по нескольким параметрам в каждом поле, необходимо разделить поисковые запросы запятыми:
> http://localhost:8001/book?title=книга,название

>Например: http://localhost:8001/book?title=книга,название&author_name=толстой,пушкин

Для постраничной навигации добавьте параметр **page** в URL запроса:
> http://localhost:8001/book?title=книга,название&page=NUM

>Например: http://localhost:8001/book?title=книга,название&author_name=толстой,пушкин&page=2
